<!doctype html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="/percent-calculator/icons/android-launchericon-192-192.png">
  <meta name="theme-color" content="#0b0f14">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>% Range Calculator</title>

  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>% Range Calculator</div>
      <div class="status" id="status">0DTE-ready</div>
    </div>

    <div class="card">
      <div class="section">
        <div class="grid">
          <!-- LEFT -->
          <div class="gridLeft">
            <div class="field w-lg">
              <label>Price</label>
              <input id="base" class="input" inputmode="decimal" value="1000" />
            </div>

            <div class="field w-sm">
              <label>Max (%)</label>
              <input id="max" class="input" inputmode="decimal" value="5" />
            </div>
          </div>

          <!-- RIGHT -->
          <div class="gridRight">
            <div id="chgWrap" class="chgWrap" aria-live="polite">
              <div id="chgBadge" class="chgBadge is-hidden">
                <span id="chgTf" class="chgTf">1D</span>
                <span id="chgArrow" class="chgArrow">â–²</span>
                <span id="chgVal" class="chgVal">+0.00%</span>
              </div>
            </div>

            <div class="field w-sm">
              <label>Step (%)</label>
              <input id="step" class="input" inputmode="decimal" value="0.5" />
            </div>
          </div>
        </div>

        <div class="grid2">
          <div class="field w-sm">
            <label>Decimals</label>
            <input id="decimals" class="input" inputmode="numeric" value="2" />
          </div>

          <div class="field w-md">
            <label>ATM Straddle (pts)</label>
            <input id="emPts" class="input" inputmode="decimal" placeholder="e.g. 12.5" />
          </div>
        </div>
      </div>
    </div>

    <div class="btnRow">
      <button class="chip primary" id="btnSPY" type="button">SPY</button>
      <button class="chip" id="btnQQQ" type="button">QQQ</button>
      <button class="chip" id="btnIWM" type="button">IWM</button>

      <button class="primary" id="calc" type="button">Calculate</button>
      <button id="btnW1" type="button">W-1: OFF</button>
      <button id="auto" type="button">Auto: ON</button>
      <button id="focus" type="button">Focus: ON</button>
      <button id="clear" type="button">Clear</button>
    </div>

    <div id="err" class="error"></div>

    <div class="split">
      <div class="tablePanel">
        <table id="tbl">
          <thead>
            <tr>
              <th class="colP">%</th>
              <th class="colMinus">-</th>
              <th class="colPlus">+</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="weekPanel">
        <div class="weekHeader">
          <div class="weekTitle">(52w)</div>
          <div class="weekSub" id="weekSub">Select an ETF</div>
        </div>
        <div class="weekList" id="weekList"></div>
      </div>
    </div>

    <!-- NEW: full-width credit spread panel -->
    <div class="csSection">
      <div class="csHeader">
        <div class="csTitle">Credit Spread</div>
        <div class="csSub">Width / Credit / Contracts</div>
      </div>

      <div class="csGrid">
        <div class="field">
          <label>Width ($)</label>
          <input id="csWidth" class="input" inputmode="decimal" value="20" />
        </div>

        <div class="field">
          <label>Credit ($)</label>
          <input id="csCredit" class="input" inputmode="decimal" value="1" />
        </div>

        <div class="field csContracts">
          <label>Contracts</label>
          <div class="csQty">
            <button id="csMinus" type="button">-25</button>
            <input id="csContracts" class="input" inputmode="numeric" value="100" />
            <button id="csPlus" type="button">+25</button>
          </div>
        </div>
      </div>

      <div class="csOut">
        <div class="csBox">
          <div class="csLbl">Max Profit</div>
          <div class="csVal" id="csProfit">$0</div>
        </div>
        <div class="csBox">
          <div class="csLbl">Max Risk</div>
          <div class="csVal" id="csRisk">$0</div>
        </div>
        <div class="csBox">
          <div class="csLbl">ROR</div>
          <div class="csVal" id="csRor">0%</div>
        </div>
      </div>

      <div class="csTblWrap">
        <table class="csTbl">
          <thead>
            <tr>
              <th>ROR%</th>
              <th>Credit</th>
              <th>Profit</th>
              <th>Risk</th>
            </tr>
          </thead>
          <tbody id="csTbody"></tbody>
        </table>
      </div>
    </div>

      <!-- =========================
          RISK TRACKER (Option A)
          Place this directly BELOW your existing CREDIT SPREAD section
      ========================== -->
      <section class="panel" id="riskTracker">
        <div class="panelHeader">
          <div>
            <div class="kicker">RISK TRACKER</div>
          </div>
          <div class="panelActions">
            <button class="btn" id="btnAddPos">+ Add position</button>
            <button class="btn btnGhost" id="btnClearPos">Clear</button>
          </div>
        </div>

        <!-- Budget + totals row -->
        <div class="cards4">
          <div class="miniCard">
            <div class="miniLabel">Risk budget</div>
            <input class="miniInput" id="riskBudget" inputmode="numeric" placeholder="25 000" />
          </div>

          <div class="miniCard">
            <div class="miniLabel">Risk used</div>
            <div class="miniValue red" id="totMaxRisk">$0</div>
          </div>

          <div class="miniCard">
            <div class="miniLabel">Risk left</div>
            <div class="miniValue neutral" id="riskRemaining">$0</div>
            <div class="miniHint" id="riskUsedPct">Set a budget</div>
          </div>

          <div class="miniCard">
            <div class="miniLabel">TOTAL MAX PROFIT</div>
            <div class="miniValue green" id="totMaxProfit">$0</div>
            <div class="miniHint" id="portfolioRor"></div>
          </div>
        </div>

        <!-- Positions table -->
        <div class="tableWrap" style="margin-top:14px;">
          <table class="table" id="posTable">
            <thead>
              <tr>
                <th style="width:110px;">Ticker</th>
                <th style="width:140px;">Type</th>
                <th style="width:140px;">Expiry</th>
                <th style="width:120px; text-align:right;">Contracts</th>
                <th style="width:110px; text-align:right;">Width</th>
                <th style="width:130px; text-align:right;">Net Credit</th>
                <th style="width:150px; text-align:right;">Max Profit</th>
                <th style="width:150px; text-align:right;">Max Risk</th>
                <th style="width:70px; text-align:center;">Del</th>
              </tr>
            </thead>
            <tbody id="posTbody">
              <!-- rows injected by JS -->
            </tbody>
          </table>
        </div>

        <div class="hintRow" style="margin-top:10px; opacity:.7; font-size:12px;">
          Tip: Width in $ (e.g., 10). Net Credit per share (e.g., 1.25). Totals = sum of rows.
        </div>
      </section>

    <div class="hint">Tap a row to lock highlight. Use SPY/QQQ/IWM buttons to auto-fill base.</div>
  </div>
  
  <script src="./app.js" defer></script>
</body>
</html>
